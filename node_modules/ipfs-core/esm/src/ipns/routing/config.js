import { TieredDatastore } from 'datastore-core/tiered';
import get from 'dlv';
import { IpnsPubsubDatastore } from './pubsub-datastore.js';
import { OfflineDatastore } from './offline-datastore.js';
export function createRouting({libp2p, repo, peerId, options}) {
  const ipnsStores = [];
  let pubsubDs;
  if (get(options, 'EXPERIMENTAL.ipnsPubsub', false)) {
    const pubsub = libp2p.pubsub;
    const localDatastore = repo.datastore;
    pubsubDs = new IpnsPubsubDatastore(pubsub, localDatastore, peerId);
    ipnsStores.push(pubsubDs);
  }
  if (get(options, 'offline') || !get(options, 'libp2p.config.dht.enabled', false)) {
    const offlineDatastore = new OfflineDatastore(repo);
    ipnsStores.push(offlineDatastore);
  } else {
    ipnsStores.push(libp2p._dht);
  }
  return new TieredDatastore(ipnsStores);
}